<!-- Top blue bar -->
<div class="top-bar"></div>

<!-- Header with UF Lastinger Center branding -->
<header class="uf-header">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-3">
        <a href="{{ base_path }}/tags_index{{ ext }}" class="uf-logo">
          <img src="/ufl_tag_manager/assets/uf_logo.png" 
               alt="UF Lastinger Center" 
               class="uf-logo-img"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
               onload="console.log('Image loaded successfully:', this.src);">
          <div class="uf-logo-fallback" style="display:none;">
            <div class="uf-logo-text">
              <span class="uf-brand">UF</span>
              <div class="uf-divider"></div>
              <div class="uf-text">
                <span class="uf-name">Lastinger Center</span>
                <span class="uf-subtitle">UNIVERSITY OF FLORIDA</span>
              </div>
            </div>
          </div>
        </a>
      </div>
      <div class="col-md-6">
      </div>
      <div class="col-md-3">
        <div class="header-nav">
          <div class="nav-dropdown">
            <a href="{{ base_path }}/tags_index{{ ext }}" class="nav-item">
              Tag Management
              <svg class="dropdown-icon" width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <div class="dropdown-content">
              <a href="{{ base_path }}/tags{{ ext }}" class="dropdown-item {% if page_name == 'tags' %}active{% endif %}">Manage Tag Categories</a>
              <a href="{{ base_path }}/tag_values{{ ext }}" class="dropdown-item {% if page_name == 'tag_values' %}active{% endif %}">Manage Tag Values</a>
              <a href="{{ base_path }}/section_tags{{ ext }}" class="dropdown-item {% if page_name == 'section_tags' %}active{% endif %}">Manage Section Tag Mappings</a>
              <a href="{{ base_path }}/section_tags_inserts{{ ext }}" class="dropdown-item {% if page_name == 'section_tags_inserts' %}active{% endif %}">Bulk Insert into Section Tags</a>
            </div>
          </div>
          <a href="{{ base_path }}/logs{{ ext }}" class="nav-item {% if page_name == 'logs' %}active{% endif %}">Logs</a>
          <a href="{{ base_path }}/rules{{ ext }}" class="nav-item {% if page_name == 'rules' %}active{% endif %}">Rules</a>
          <a href="{{ base_path }}/documentation{{ ext }}" class="nav-item">User Guide</a>
          <a href="" class="nav-item" id="snowflake-link" onclick="runSnowflake(event)">Rebuild Demo Table</a>
        </div>
      </div>
    </div>
  </div>



    <style>
        /* Optional: Make the link look disabled when working */
        .disabled-link {
            pointer-events: none;
            color: gray;
            text-decoration: none;
            cursor: wait;
        }
    </style>

    <script>
        async function runSnowflake(event) {
            event.preventDefault();
            const linkElement = document.getElementById('snowflake-link');
            const originalText = linkElement.innerText;

            linkElement.innerText = "Working...";
            linkElement.classList.add("disabled-link");

            try {
                const response = await fetch('/ufl_tag_manager/run_snowflake.py', {
                    method: 'GET', 
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                linkElement.innerText = "Success: " + data.message;
                
                setTimeout(() => {
                    linkElement.innerText = originalText;
                    linkElement.classList.remove("disabled-link");
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                linkElement.innerText = "Error: Check Console";
                linkElement.classList.remove("disabled-link");
            }
        }
    </script>
  
</header>