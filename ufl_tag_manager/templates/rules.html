{% extends 'tags_base.html' %}
{% block title %}Rules{% endblock %}
{% block content %}

<style>
  .wrap { max-width: 1300px; margin: 0 auto; }
  .msg { margin: 8px 0; }
  .msg.success { color:#0a8a0a; }
  .msg.danger { color:#c62828; }
  a { text-decoration:none; }

  table { width:100%; border-collapse:collapse; background:#fff; table-layout:fixed; }
  th, td {
    padding:10px;
    border-bottom:1px solid #eee;
    text-align:left;
    font-size:14px;
    vertical-align:top;
    word-break:break-word;
  }
  th {
    background:#f3f4f6;
    position:sticky;
    top:0;
    z-index:1;
    font-weight:600;
  }

  th.rule-name, td.rule-name { width: 26%; }
  th.column-col, td.column-col { width: 14%; }
  th.description, td.description { width: 30%; }
  th.endpoint, td.endpoint { width: 15%; }
  th.segment, td.segment { width: 15%; }
  th.section-tag, td.section-tag { width: 14%; }
  th.tag-name, td.tag-name { width: 10%; }
  th.tag-value, td.tag-value { width: 15%; }
  th.order, td.order { width: 10%; }
  th.code, td.code { width: 8%; }

  td.rule-name code {
    display:block;
    line-height:1.4;
    background:#f1f5f9;
    padding:4px 6px;
    border-radius:4px;
    font-size:12px;
  }

  .detail-card{
    background:#fff;
    border:1px solid #eee;
    border-radius:10px;
    padding:18px;
    margin-top:14px;
  }
  .detail-card .label{
    font-weight:700;
    margin-top:10px;
  }
  pre.codebox{
    margin-top: 10px;
    background:#0b1020;
    color:#e5e7eb;
    padding:16px;
    border-radius:6px;
    overflow-x:auto;
    font-size:13px;
    line-height:1.5;
  }
</style>

<div class="wrap">

  {% if view == "detail" %}

    <p><a href="{{ base_path }}/rules{{ ext }}">&larr; Back to all rules</a></p>

    {% if r %}
      <h2>Rule: <code>{{ r.rule_name }}</code></h2>

      <div class="detail-card">
        <div class="label">Endpoint</div>
        <div>{{ r.endpoint or "" }}</div>

        <div class="label">Segment</div>
        <div>{{ r.segment or "" }}</div>

        <div class="label">Section Tag</div>
        <div>{{ r.section_tag or "" }}</div>

        <div class="label">Tag Name</div>
        <div>{{ r.tag_name or "" }}</div>

        <div class="label">Tag Value Text</div>
        <div>{{ r.tag_value_text or "" }}</div>

        <div class="label">Order</div>
        <div>{{ r.order or "" }}</div>

        <div class="label">Column</div>
        <div>{{ r.column or "" }}</div>

        <div class="label">Description</div>
        <div>{{ r.description or "" }}</div>
      </div>

      <h3 style="margin-top:20px;">Method / Code</h3>
      <pre class="codebox">{{ r.method_source }}</pre>

    {% else %}
      <div class="msg danger">No rule details to display.</div>
    {% endif %}

  {% else %}

    <h2 style="color:#2c6cc7;text-align:center;margin-bottom:30px;">Rules</h2>

    {% if messages %}
      {% for cat, msg in messages %}
        <div class="msg {{ cat }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}

    {% if rows|length == 0 %}
      <div class="msg danger">No rules found.</div>
    {% else %}
      <table>
        <thead>
          <tr>
            <th class="rule-name">Rule Name</th>
            <th class="endpoint">Endpoint</th>
            <th class="segment">Segment</th>
            <th class="section-tag">Section Tag</th>
            <th class="tag-name">Tag Name</th>
            <th class="tag-value">Tag Value</th>
            <th class="column-col">Column</th>
            <th class="order">Order</th>
            <th class="description">Description</th>
            <th class="code">Code</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td class="rule-name"><code>{{ r.rule_name }}</code></td>
              <td class="endpoint">{{ r.endpoint or "-" }}</td>
              <td class="segment">{{ r.segment or "-" }}</td>
              <td class="section-tag">{{ r.section_tag or "-" }}</td>
              <td class="tag-name">{{ r.tag_name or "-" }}</td>
              <td class="tag-value">{{ r.tag_value_text or "-" }}</td>
              <td class="column-col">{{ r.column or "-" }}</td>
              <td class="order">{{ r.order or "-" }}</td>
              <td class="description">{{ r.description or "-" }}</td>
              <td class="code">
                <a href="{{ base_path }}/rules{{ ext }}?detail={{ r.rule_name|urlencode }}">View</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

    <p style="margin-top:16px;">
      <a href="{{ base_path }}/tags_index{{ ext }}">Back to Tag Home</a>
    </p>

  {% endif %}

</div>

{% endblock %}
