{% extends "tags_base.html" %}

{% block title %}Manage Tag Categories{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h2>Manage Tag Categories</h2>
  {% if messages %}
    {% for cat, msg in messages %}
      <div class="alert {{ 'alert-danger' if cat == 'danger' else 'alert-success' }} py-2">
        {{ msg }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="POST" action="{{ base_path }}/tags{{ ext }}" class="mb-4">
    <input type="hidden" name="action" value="add">

    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="tag_name">Tag name<span class="text-danger">*</span></label>
        <input
          id="tag_name"
          name="tag_name"
          type="text"
          class="form-control"
          placeholder="Tag name"
          required
        >
      </div>

      <div class="form-group col-md-6">
        <label for="description">Description (optional)</label>
        <input
          id="description"
          name="description"
          type="text"
          class="form-control"
          placeholder="Short description"
        >
      </div>

      <div class="form-group col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary btn-block" style ="background-color:#0b3d91;">
          Add Tag
        </button>
      </div>
    </div>
  </form>

  <hr>
  <h3 class="mb-3" style="color:#0b3d91;">Existing Tags</h3>

  {% if tags and tags|length > 0 %}
    <div class="table-responsive">
      <table class="table table-sm table-hover">
        <thead>
          <tr>
            <th style="width: 30%;">Tag Name</th>
            <th style="width: 55%;">Tag Description</th>
            <th style="width: 15%;" class="text-right">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for t in tags %}
            <tr>
              <td>{{ t.tag_name }}</td>
              <td>
                {% if t.description %}
                  {{ t.description }}
                {% else %}
                  <span class="text-muted">No description</span>
                {% endif %}
              </td>
              <td class="text-right">
                <form
                  method="POST"
                  action="{{ base_path }}/tags{{ ext }}"
                  onsubmit="return confirmDeleteTag();"
                  class="d-inline"
                >
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="tag_id" value="{{ t.tag_id or t.id }}">
                  <input type="hidden" name="tag_name" value="{{ t.tag_name }}">
                  <button type="submit" class="btn btn-danger btn-sm">
                    Delete
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No tags found.</p>
  {% endif %}

  <div class="mt-3">
    <a
      href="{{ base_path }}/tags_index{{ ext }}"
      class="btn-link"
    >
      Back to Tag Home
    </a>
  </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
  function confirmDeleteTag() {
    return confirm("Are you sure you want to delete this tag?");
  }
</script>
{% endblock %}
